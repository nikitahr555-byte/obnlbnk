# Инструкции по работе с базой данных

## Общая информация

Приложение использует SQLite в качестве основной базы данных. При деплое на Render.com необходимо учитывать особенности хранения данных.

## Особенности SQLite на Render.com

Render.com использует эфемерную файловую систему, что означает:
- Все файлы в корне проекта **будут сброшены** при перезапуске сервиса
- Для постоянного хранения данных необходимо использовать Disk Volume

## Настройка постоянного хранения данных

### 1. Структура хранения файлов

```
/opt/render/project/src/         # Корневая директория проекта на Render
├── data/                        # Постоянное хранилище (Disk Volume)
│   └── sqlite.db                # База данных (сохраняется при перезапусках)
├── sqlite.db                    # Рабочая копия базы (копируется из data/ при запуске)
└── ...                          # Остальные файлы проекта
```

### 2. Операции с базой данных

| Операция | Описание |
|----------|----------|
| Создание | База данных автоматически создается при первом запуске |
| Бэкап | Выполняется автоматически при запуске и по расписанию |
| Восстановление | Копирование из `/data/sqlite.db` при запуске |
| Миграции | Используйте `npm run db:push` для применения изменений |

## Импорт и экспорт данных

### Экспорт данных

Для экспорта данных из базы используйте API или скрипты:

```bash
# Экспорт через API (требует запущенное приложение)
curl -X GET http://localhost:5000/api/backup

# Экспорт через скрипт
tsx scripts/backup-app-state.ts
```

### Импорт данных

Для импорта данных в базу:

```bash
# Импорт через скрипт
tsx scripts/restore-app-state.ts
```

## Работа с данными через SQLite Web

Для удобства работы с базой данных можно использовать SQLite Web:

```bash
# Запуск интерфейса SQLite Web
python3 -m sqlite_web sqlite.db
```

## Миграции и обновления схемы

Для обновления схемы базы данных:

1. Отредактируйте схему в `shared/schema.ts`
2. Запустите миграцию:
   ```bash
   npm run db:push
   ```

## Резервные копии на Render.com

Для работы с резервными копиями на Render.com:

1. Резервные копии сохраняются в директории `/data/backup`
2. Для ручного бэкапа используйте API `/api/backup`
3. Для восстановления из бэкапа используйте API `/api/restore` (требует аутентификации)

## Техническая поддержка

Если у вас возникли проблемы с базой данных, обратитесь к разработчикам или создайте issue в репозитории проекта.