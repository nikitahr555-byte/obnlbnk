# Резервное копирование и восстановление данных 

## Общая информация

При переходе с Replit на Render.com важно правильно перенести базу данных. В данной инструкции описаны шаги по резервному копированию и восстановлению данных.

## Резервное копирование данных

Система автоматически создает резервные копии данных:
- Каждые 24 часа
- При каждом запуске приложения

### Форматы резервных копий:
1. **JSON файлы** - отдельные файлы для каждой таблицы в директории `/backup`
2. **ZIP архивы** - полный архив всех данных в директории `/backup/zip`
3. **SQL дампы** - SQL-скрипты для восстановления в директории `/backup/sql`

### Ручное создание резервной копии

Для создания резервной копии вручную можно использовать API:

```
GET /api/backup
```

Или выполнить скрипт:

```bash
# С помощью Node.js
node -e "require('./dist/server/database/backup.js').exportDatabase()"

# Или для разработки
tsx scripts/backup-app-state.ts
```

## Восстановление данных на Render.com

### 1. Подготовка данных для переноса

1. Загрузите последнюю резервную копию с Replit (файлы из директории `/backup`)
2. Сохраните файл SQLite с данными (`sqlite.db`)

### 2. Восстановление на Render.com

#### Автоматический способ (рекомендуется)

1. Загрузите проект на GitHub
2. Подключите репозиторий к Render.com
3. Укажите в настройках Render использование существующей конфигурации из файла `render.yaml`
4. Создайте Disk Volume и укажите его в настройках сервиса (или используйте готовый конфиг из render.yaml)
5. Загрузите файл `sqlite.db` в директорию `/data` через Render Dashboard

#### Ручной способ

1. Создайте новый Web Service на Render.com
2. Настройте переменные окружения:
   - `NODE_ENV=production`
   - `RENDER=true`
   - `TELEGRAM_BOT_TOKEN=ваш_токен_бота`
3. Создайте Disk Volume и подключите его к директории `/opt/render/project/src/data`
4. Настройте скрипты сборки и запуска:
   - Build Command: `npm install && npm run build && mkdir -p ./data && cp sqlite.db ./data/ || true`
   - Start Command: `NODE_ENV=production node dist/index.js`
5. Загрузите базу данных через Render Dashboard в директорию `/data`

## Проверка после восстановления

1. Убедитесь, что приложение успешно запустилось
2. Проверьте работу Telegram бота (он должен работать в режиме webhook)
3. Проверьте наличие транзакций и данных пользователей через интерфейс приложения

## Дополнительная информация

- Файлы конфигурации для Render.com: `render.yaml`, `build.sh`, `start.sh`
- Скрипты создания и восстановления резервных копий: `server/database/backup.ts`
- Доступ к базе данных: `sqlite.db` (основной файл), `/data/sqlite.db` (на Render)

## Техническая поддержка

По всем вопросам обращайтесь в техподдержку или создавайте issue в репозитории проекта.