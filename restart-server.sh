#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ NFT —Å–µ—Ä–≤–µ—Ä–∞

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤...${NC}"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Node.js
echo -e "${YELLOW}‚ö†Ô∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js...${NC}"
pkill -f "node" || true
sleep 1

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
NODE_PROCESSES=$(pgrep -f "node" | wc -l)
if [ "$NODE_PROCESSES" -gt 0 ]; then
  echo -e "${YELLOW}‚ö†Ô∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js...${NC}"
  pkill -9 -f "node" || true
  sleep 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
NODE_PROCESSES=$(pgrep -f "node" | wc -l)
if [ "$NODE_PROCESSES" -gt 0 ]; then
  echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js${NC}"
  echo -e "${RED}‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Replit –≤—Ä—É—á–Ω—É—é${NC}"
  exit 1
else
  echo -e "${GREEN}‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã${NC}"
fi

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
echo $(date) > .restart_signal
echo -e "${GREEN}‚úÖ –°–æ–∑–¥–∞–Ω —Å–∏–≥–Ω–∞–ª –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞${NC}"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è Replit
echo -e "${BLUE}üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ start-replit.sh...${NC}"
bash start-replit.sh